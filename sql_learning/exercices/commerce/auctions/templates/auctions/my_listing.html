{% extends "auctions/layout.html" %}

{% block body %}
    {% if user.username == request.user.username %}
    
        <h2>My listing</h2>
    
    {% else %}

        <h2>{{ user.username }}'s listing</h2>

    {% endif %}
    
    <ul>
        {% if my_listings %}
            {% for listing in my_listings %}
                <ul>
                    <div class="title">
                        <a href="{% url 'listing' listing.id %}">
                            <h3>{{ listing.title }}</h3>
                        </a>
                        <div class="image-container">
                            {% if request.user != listing.user %}
                                <!-- The image is now wrapped in a form to act as a button -->
                                <form method="POST" action="{% url 'toggle_watchlist' listing.id %}">
                                    {% csrf_token %}
                                    <button type="submit" style="border: none; background: transparent; padding: 0;">
                                        {% if listing.id in watchlist_items %}
                                            <img class="watchlist" src="/media/full_star.png" alt="watchlist_star" width="40">
                                            <p class="text-overlay">Already in your watch list</p>
                                        {% else %}
                                            <img class="watchlist" src="/media/empty_star.png" alt="watchlist_star" width="40">
                                            <p class="text-overlay">Add to your watch list</p>
                                        {% endif %}
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>

                    {% if listing.image_url %}
                        <img src="{{ listing.image_url }}" alt="{{ listing.title }}" width="200">
                    {% endif %}

                    <p>{{ listing.description }}</p>
                    <p>Current price: ${{ listing.price }}</p>
                    <p>Last bid : by : </p>
                    {% if request.user.is_authenticated and request.user == listing.user %}

                        <form method="POST" action="{% url 'delete_listing' listing.id %}">
                            {% csrf_token %}
                            <button type="submit">Delete listing</button>
                        </form>
                    {% endif %}
                    
                </ul>
            {% endfor %}

        {% else %}
        <a>nothing here</a>
        {% endif %}
    </ul>

{% endblock %}